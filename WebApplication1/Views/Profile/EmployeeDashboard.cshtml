@model WebApplication1.ViewModels.EmployeeDashboardViewModel

@{
    ViewBag.Title = "Employee Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h2>@ViewBag.Title</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Home</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Profile")">Profile</a></li>
                    <li class="breadcrumb-item active">Employee Dashboard</li>
                </ol>
            </nav>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Pending Orders</h6>
                            <h3 class="card-text">@Model.PendingOrders</h3>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="@Url.Action("PendingOrders", "Orders")" class="text-white text-decoration-none">
                        Process Orders <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Shipped Orders</h6>
                            <h3 class="card-text">@Model.ShippedOrders</h3>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="@Url.Action("ShippedOrders", "Orders")" class="text-white text-decoration-none">
                        Track Orders <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Monthly Revenue</h6>
                            <h3 class="card-text">R @Model.TotalRevenueThisMonth.ToString("F2")</h3>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="@Url.Action("Index", "Revenue")" class="text-white text-decoration-none">
                        View Reports <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title">Low Stock Items</h6>
                            <h3 class="card-text">@Model.LowStockBooks.Count</h3>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <a href="@Url.Action("Index", "Books")" class="text-white text-decoration-none">
                        Check Stock <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Recent Orders -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-clock"></i> Recent Orders
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.RecentOrders == null || !Model.RecentOrders.Any())
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> No recent orders found.
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in Model.RecentOrders.Take(5))
                                    {
                                        <tr>
                                            <td>
                                                <strong>#@order.OrderId.ToString("D6")</strong>
                                            </td>
                                            <td>
                                                <strong>@order.Customer?.FirstName @order.Customer?.LastName</strong>
                                                <br />
                                                <small class="text-muted">@order.Customer?.Email</small>
                                            </td>
                                            <td>
                                                <strong>R @order.TotalAmount.ToString("F2")</strong>
                                            </td>
                                            <td>
                                                <span class="badge bg-@GetStatusColor(order.OrderStatus)">@order.OrderStatus</span>
                                            </td>
                                            <td>
                                                <a href="@Url.Action("Details", "Orders", new { id = order.OrderId })" class="btn btn-sm btn-outline-primary" title="View Order">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="@Url.Action("Index", "Orders")" class="btn btn-sm btn-outline-primary">
                                View All Orders
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Low Stock Books -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-warning">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle"></i> Low Stock Books
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.LowStockBooks == null || !Model.LowStockBooks.Any())
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> All books have sufficient stock!
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Book</th>
                                        <th>Author</th>
                                        <th>Stock</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var book in Model.LowStockBooks.Take(5))
                                    {
                                        <tr>
                                            <td>
                                                <strong>@book.Title</strong>
                                                <br />
                                                <small class="text-muted">by @book.Author</small>
                                            </td>
                                            <td>
                                                <small>@book.Author</small>
                                            </td>
                                            <td>
                                                <span class="badge bg-@GetStockColor(book.StockQuantity)">@book.StockQuantity</span>
                                            </td>
                                            <td>
                                                <a href="@Url.Action("Details", "Book", new { id = book.BookId })" class="btn btn-sm btn-outline-primary" title="View Book">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        if (Model.LowStockBooks.Count > 5)
                        {
                            <div class="text-center">
                                <a href="@Url.Action("Index", "Books")" class="btn btn-sm btn-outline-warning">
                                    View All Low Stock Books
                                </a>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Reviews -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-star"></i> Recent Reviews
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.RecentReviews == null || !Model.RecentReviews.Any())
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> No recent reviews found.
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Book</th>
                                        <th>Customer</th>
                                        <th>Rating</th>
                                        <th>Review</th>
                                        <th>Date</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var review in Model.RecentReviews.Take(5))
                                    {
                                        <tr>
                                            <td>
                                                <strong>@review.Book?.Title</strong>
                                                <br />
                                                <small class="text-muted">by @review.Book?.Author</small>
                                            </td>
                                            <td>
                                                <strong>@review.Customer?.FirstName @review.Customer?.LastName</strong>
                                            </td>
                                            <td>
                                                <div class="rating-stars">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        if (i <= review.Rating)
                                                        {
                                                            <i class="fas fa-star text-warning"></i>
                                                        }
                                                        else
                                                        {
                                                            <i class="far fa-star text-warning"></i>
                                                        }
                                                    }
                                                    <br />
                                                    <small class="text-muted">@review.Rating/5</small>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="review-text" style="max-width: 200px;">
                                                    @if (!string.IsNullOrEmpty(review.ReviewText))
                                                    {
                                                        @Html.Raw(review.ReviewText.Length > 50 ? review.ReviewText.Substring(0, 50) + "..." : review.ReviewText)
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">No written review</span>
                                                    }
                                                </div>
                                            </td>
                                            <td>
                                                <small>@review.ReviewDate.ToString("MMM dd")</small>
                                            </td>
                                            <td>
                                                <a href="@Url.Action("Details", "Book", new { id = review.BookId })" class="btn btn-sm btn-outline-primary" title="View Book">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <a href="@Url.Action("Index", "Book")" class="btn btn-sm btn-outline-primary">
                                View All Reviews
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2 mb-2">
                            <a href="@Url.Action("PendingOrders", "Orders")" class="btn btn-warning w-100">
                                <i class="fas fa-clock"></i> Pending Orders
                            </a>
                        </div>
                        <div class="col-md-2 mb-2">
                            <a href="@Url.Action("ShippedOrders", "Orders")" class="btn btn-info w-100">
                                <i class="fas fa-truck"></i> Shipped Orders
                            </a>
                        </div>
                        <div class="col-md-2 mb-2">
                            <a href="@Url.Action("Index", "Delivery")" class="btn btn-primary w-100">
                                <i class="fas fa-shipping-fast"></i> Deliveries
                            </a>
                        </div>
                        <div class="col-md-2 mb-2">
                            <a href="@Url.Action("Index", "Books")" class="btn btn-success w-100">
                                <i class="fas fa-book"></i> Manage Books
                            </a>
                        </div>
                        <div class="col-md-2 mb-2">
                            <a href="@Url.Action("Statistics", "Delivery")" class="btn btn-secondary w-100">
                                <i class="fas fa-chart-bar"></i> Statistics
                            </a>
                        </div>
                        <div class="col-md-2 mb-2">
                            <a href="@Url.Action("Index", "Revenue")" class="btn btn-dark w-100">
                                <i class="fas fa-chart-line"></i> Revenue
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetStatusColor(string status)
    {
        switch (status.ToLower())
        {
            case "pending":
                return "warning";
            case "shipped":
                return "info";
            case "delivered":
                return "success";
            case "cancelled":
                return "danger";
            default:
                return "secondary";
        }
    }

    private string GetStockColor(int stock)
    {
        if (stock <= 0)
            return "danger";
        if (stock < 10)
            return "warning";
        return "success";
    }
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-refresh dashboard every 30 seconds
            setTimeout(function() {
                location.reload();
            }, 30000);
        });
    </script>
}