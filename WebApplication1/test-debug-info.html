<!DOCTYPE html>
<html>
<head>
    <title>Debug Info Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px 0; padding: 10px 20px; font-size: 16px; }
        #result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        .debug-info { background-color: #e6f3ff; border-color: #0066cc; }
    </style>
</head>
<body>
    <h1>Debug Info Test</h1>
    
    <h2>Test Registration and Get Debug Info</h2>
    <button onclick="testRegistrationAndGetDebug()">Test Registration</button>
    
    <h2>Get Debug Info Only</h2>
    <button onclick="getDebugInfo()">Get Debug Info</button>
    
    <div id="result"></div>

    <script>
        async function testRegistrationAndGetDebug() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testing registration...</p>';
            
            try {
                // First, get the registration page to extract the anti-forgery token
                const getResponse = await fetch('/Account/Register');
                const html = await getResponse.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const token = doc.querySelector('input[name="__RequestVerificationToken"]');
                
                if (!token) {
                    throw new Error('Could not find anti-forgery token');
                }
                
                // Create form data
                const formData = new FormData();
                formData.append('__RequestVerificationToken', token.value);
                formData.append('FirstName', 'Debug');
                formData.append('LastName', 'Test');
                formData.append('Email', 'debugtest' + Date.now() + '@example.com');
                formData.append('Username', 'debugtest' + Date.now());
                formData.append('Password', 'Password123!');
                formData.append('ConfirmPassword', 'Password123!');
                formData.append('Role', 'Customer');
                formData.append('AcceptTerms', 'true');
                
                // Make the POST request
                const postResponse = await fetch('/Account/Register', {
                    method: 'POST',
                    body: formData
                });
                
                const responseText = await postResponse.text();
                
                resultDiv.innerHTML = `
                    <h3>Registration Response:</h3>
                    <p><strong>Status Code:</strong> ${postResponse.status} ${postResponse.statusText}</p>
                    <p><strong>Response Length:</strong> ${responseText.length} characters</p>
                    <p><strong>Response Preview:</strong></p>
                    <pre>${responseText.substring(0, 500)}${responseText.length > 500 ? '...' : ''}</pre>
                    <hr>
                    <p><em>Now checking for debug info...</em></p>
                `;
                
                // Wait a moment and then check for debug info
                setTimeout(getDebugInfo, 1000);
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>Error:</h3>
                    <pre>${error.stack || error.message || error}</pre>
                `;
            }
        }
        
        async function getDebugInfo() {
            const resultDiv = document.getElementById('result');
            
            try {
                // Try to get debug info from a simple action
                const response = await fetch('/Account/TestDebug');
                const debugText = await response.text();
                
                resultDiv.innerHTML += `
                    <h3>Debug Info from TestDebug:</h3>
                    <pre>${debugText}</pre>
                `;
                
                // Also try to get any TempData that might be available
                resultDiv.innerHTML += `
                    <hr>
                    <h3>Registration Status:</h3>
                    <p>Check the IIS Express console for detailed debug information.</p>
                    <p>The Register action writes debug info to TempData["DebugInfo"], but we need to access it differently.</p>
                `;
                
            } catch (error) {
                resultDiv.innerHTML += `
                    <h3>Error getting debug info:</h3>
                    <pre>${error.stack || error.message || error}</pre>
                `;
            }
        }
    </script>
</body>
</html>